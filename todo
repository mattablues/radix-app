## Plan: Separera framework‑ och app‑tester (utan att dela repo än)
Mål: göra `framework/` lätt att lyfta ut senare genom att gradvis separera **testernas struktur**, **körning**, och **kontrakt** – men allt ligger kvar i samma projekt.
### Fas 0 – Nuläge (det ni redan har uppnått)
- PHPUnit grönt.
- PHPStan grönt.
- Arkitekturtestet grönt: `framework/src` får inte referera till `App\\...` och vissa “helpers” (med regex-regler).
- Infection dödar mutanter.

Det är en stabil bas att bygga vidare på.
### Fas 1 – Skapa en tydlig test‑indelning i filsystemet
Skapa en ny rotmapp för framework-tester:
- `tests/Framework/`

Flytta in tester som primärt testar `framework/src/*` (Radix‑namespaces), t.ex.:
- `tests/Framework/Architecture/FrameworkMustNotDependOnAppTest.php`
- `tests/Framework/Database/ORM/*`
- `tests/Framework/Database/QueryBuilder/*`
- `tests/Framework/Container/*`
- `tests/Framework/Routing/*`
- `tests/Framework/Viewer/*`
- `tests/Framework/Http/*` (om det är framework HTTP primitives, inte app controllers)

**Tumregel:**
Om testets huvudsakliga SUT är `Radix\...` och det går att köra utan att starta “app bootstrap”, så är det ett framework-test.
Du kan behålla nuvarande namespaces i testklasserna i början (ingen brådska att byta).
### Fas 2 – Dela upp PHPUnit i två suites (fortfarande samma repo)
I (eller ), definiera: `phpunit.xml``phpunit.xml.dist`
- suite: kör bara `tests/Framework` `framework`
- `app` suite: kör resten men exkludera `tests/Framework`

Exempel:``` xml
<testsuites>
  <testsuite name="framework">
    <directory>tests/Framework</directory>
  </testsuite>

  <testsuite name="app">
    <directory>tests</directory>
    <exclude>tests/Framework</exclude>
  </testsuite>
</testsuites>
```
Det låter dig köra:
vendor/bin/phpunit --testsuite framework
vendor/bin/phpunit --testsuite app
Och i CI kan ni köra dem som separata jobb.

Fas 3 – Rensa beroenden i framework‑testsviten
Målet är att --testsuite framework ska kunna köras med minimal app‑setup.
Gör gradvis:
Undvik ApplicationContainer::set(...) om testet inte behöver det.
Undvik App\\... i assertions/fixtures om det går (om det används bara som dummy class-string är det okej, men håll koll).
Skapa små “test doubles” i testet i stället för att peka på app‑modeller.

Fas 4 – Dela upp Infection-körningen (valfritt, men bra senare)
Ni kan senare köra två Infection-jobb:
Framework mutation
source.directories: bara framework/src
kör phpunit --testsuite framework
App mutation
source.directories: bara src
kör phpunit --testsuite app
Det brukar ge snabbare CI och renare signal.

Fas 5 – Dela upp PHPStan (valfritt)
På sikt kan ni ha:
phpstan-framework.neon (analyserar framework/src, egna regler)
phpstan-app.neon (analyserar src, app-regler)
Och köra två jobb, eller ett jobb med två configs.

Fas 6 – Förbered “extract” (när ni vill lyfta ut framework)
När allt ovan är stabilt:
Skapa egen composer.json i framework/ med PSR‑4 mapping för Radix\\.
Flytta tests/Framework med till framework-paketet (eller duplicera tillfälligt).
Låt appens root composer.json kräva framework som path-repo först (lokal utveckling), sedan som git-repo.

Praktiska checkpoints (så du vet att du är “redo”)
phpunit --testsuite framework kör grönt utan att behöva app-specifika env-variabler.
phpunit --testsuite app kör grönt.
Arkitekturtestet ligger i framework-suiten och förhindrar regression.
Infection kan köras per suite.